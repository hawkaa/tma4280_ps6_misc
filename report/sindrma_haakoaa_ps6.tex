\documentclass{article}

\usepackage{fancyhdr} % Required for custom headers
\usepackage[utf8]{inputenc}
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage[usenames,dvipsnames]{color} % Required for custom colors
\usepackage{graphicx} % Required to insert images
\usepackage{listings} % Required for insertion of code
\usepackage{color}
\usepackage{courier} % Required for the courier font
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage[norsk]{babel}
\usepackage{amsmath}

% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.25in

\linespread{1.1} % Line spacing

% Set up the header and footer
\pagestyle{fancy}

\lhead{\exerciseGroup} % Top left header
\chead{\exerciseClass: \exerciseTitle} % Top center head
\rhead{\firstxmark} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule

\setlength\parindent{0pt} % Removes all indentation from paragraphs


% Document data

\newcommand{\exerciseTitle}{Øving 6} % Assignment title
\newcommand{\exerciseClass}{TMA4280} % Course/class
\newcommand{\exerciseGroupMembers}{Sindre Magnussen og Håkon Åmdal}
%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\title{
\vspace*{\stretch{1}}
\noindent\HRule
\begin{center}
 \Huge
 \noindent	\exerciseClass \\
 \noindent \exerciseTitle \\ [4mm]
 \large
 \noindent\emph{\exerciseGroupMembers}
\noindent\HRule \newline
\end{center}
\vspace{0cm}
\begin{center}
	\includegraphics[width=10cm]{img/kongull.jpg}
\end{center}
\vspace*{\stretch{3}}
\begin{center}
\end{center}
}
% Insert date here if you want it to appear below your name

\newcommand{\ub}[1]{\underbar{$#1$}\,}


\begin{document}
\pagestyle{empty}
\maketitle

\thispagestyle{empty}

\newpage \tableofcontents


\newpage

\pagenumbering{arabic}

\section{Introduksjon - Poisson-problemet}
Poisson-ligningen er en av de mest kjente partielle diffensialligingene, og skrives på formen:
\begin{equation}
	-\nabla^2 u = f
\end{equation}
Her er $\nabla^2$ kjent som Laplace-operatoren.\\
\\
Liginingen brukes som en matematisk modell til å beskrive flere fysiske systemer, som oftest diffusjonsprosesser. Eksempler på typiske fysiske fenomener er beregning av elektrisk felt i et domene, tilnærminger av flyt i fluidmekanikk, varmeoverføring uten varmetap. Poisson-ligingen dukker også opp når man skal regne ut egenverdier.\\
\\
Et poissonproblem er et problem der man skal finne en løsning til poisson-ligningen gitt en funksjon $f$ og et gitt domene med grensebetingelser. Grensebetingelsene må til for å få en unik løsning på problemet. Problemet som skal løses i denne øvingen lyder som følger:
% Dette er tatt direkte fra ps6.tex %
\begin{eqnarray}
	-\nabla^2 u & = & f \hspace{.5in} \textrm{in} \,\,\, \Omega = (0,1)\times (0,1) \\
	u & = & 0 \hspace{.5in} \textrm{on} \,\,\, \partial\Omega\, .
\end{eqnarray}
Her er $f$ en funksjon vi kjenner,  og $u$ er løsningen vi skal komme frem til. Vi har gitt at et enhetskvadrat  er vårt domenee, og at verdiene i kantene av dette kvadratet er $0$ (homogene Dirichlet grensebetingelser). Vi kan ikke gjøre noen antagelser om $f$, annet at den er reell.
\emph{AM - Er den reell?}\\
\\
Siden denne skal løses på en datamaskin, må vi finne en tilnærming til løsningen $u$, siden en datamaskin har begrenset med ressurser (minne/regnekraft). Det er flere måter å diskretisere poisson-ligningen på (finite differences, finite elements and finite volumes \emph{AM - Hva heter dette på norsk?}), men alle disse ender opp med et sett med ligninger som kan skrives på formen:
\begin{equation}
  \ub{A} \ub{u} = \ub{g}
\end{equation}

\begin{figure}[t]
	\label{fig:finite-difference}
	\centering
	\includegraphics[width=10cm]{img/finite-difference.png}	
	\caption{Oppretting av et ligningsystem ved hjelp av endelige differanser. Figur funnet på \cite{rdw}. }
	
\end{figure}

Siden \emph{TMA4280} underviser i endelige differanser, og dette er ofte beskrevet som den enkleste metoden, er dette også utgangspunktet for denne oppgaven. Oppgaven beskriver et todimensjonalt poissonproblem, og da fylles ligningssettet ut med en maske som vist i figur \ref{fig:finite-difference} (fempunktsformelen).

\section{Mulige løsningsstragegier}
Siden poisson-problemet dukker opp som en egnet matematisk modell for så mange fysiske problemer, er det blitt utviklet en rekke algoritmer for å løse dette problemet. Det finnes flere måter å løse et system av ligninger på, men ved å se på egenskapene til ligningssettet poisson-problemet genererer, finner man flere måter å optimalisere algoritmen på; både når det gjelder kjøretid og plassbruk.
\subsection{Direkte metoder}
Dirkete metoder løser et system med ligninger i et endelig og forutsigbart antall steg, og er spesielt egnet når matrisene er symmetriske og positivt definitt (som ligningssettet produsert ved hjelp av endelige differanser). Eksempelet på den mest generiske direkte metoden er LU-faktorisering, med følgende asymptotiske egenskaper:
\begin{align*}
      \mathcal{N}_{op} &\sim \mathcal{O}(N^3), \\
      \mathcal{M} &\sim \mathcal{O}(N^2).
\end{align*}
Her er $\mathcal{N}_{op}$ antall FLOP og $\mathcal{M}$ minnebruk (i bytes).\\
\\
Det er ofte vanlig å utnytte at matrisen er \emph{AM - sparse} for å redusere minnebruk og antall flyttallsoperasjoner.
\subsection{Iterative metoder}
Sammenlign med vanlig LU-faktorisering. Ikke så veldig mye , men nok til å sette det i perspektiv.
Generelt sett, drar iterative metoder fordel av at vi ikke lenger har noen krav om hvordan matrisen er lagret.

\section{Beskrivelse av løsning}
Vi har delt det opp, og har et felles bibilotek.

\subsection{Ulike programkomponenter}
\subsubsection{poisson}
\subsubsection{convergence}

\subsection{Testing}

\section{Tester og resultater}
Med unntak av konvergenstestene, så ble testene gjennomført ved å kjøre programmet ti ganger. Den største og minste kjøretiden ble fjernet, og gjennomsnittet ble regnet ut. Koden for testene under ble kompilert med de samme instillingene, det vil si at både MPI og OpenMP var aktivert. 
Det vil si at vi kjørte programmene med \emph{mpirun} og heller varierte parameterene vi sendte med til kjøringen. Vi ville heller kjøre testene på en ekvivalent måte, enn å ha forsjellige måter å kjøre programmet på gitt forskjellige parametre. 

\subsection{Konvergens med ulik p}

\subsection{Kjøretid med forskellige p*t = 36}
Denne testen ble gjennomført for noen kombinasjoner som gir \emph{p} * \emph{t} = 36. Resultatet er vist i tabell \ref{p/t-table}.

\begin{table}
\begin{center}
	
	\begin{tabular}{c | c | c}
	\hline \hline 
	Antall prosesser      &    Antall tråder     &    Kjøretid (i sekunder) 	    \\ \hline	
	12		      &		1	     &	  32.690540       		    \\ \hline
	6		      &         2	     &    32.975599       		    \\ \hline
	4		      &         3	     &    33.223129	    		    \\ \hline
	3   		      &		2	     &    33.633001	    		    \\ \hline
	2		      &         6	     &    34.279941	    		    \\ \hline
	1		      &		12	     &    35.741616	    		    \\ \hline
	
	\end{tabular}
\end{center}
\caption{Kjøretider gitt forskjellige kompinasjoner av \emph{p} og \emph{t}.}
\label{p/t-table}
\end{table}

Som tabell \ref{p/t-table} viser, er det faktisk negativt å bruke en hybrid-løsning. Vi ser at kjøretiden blir litt større jo flere tråder vi bruker. Grunnen er at det koster å opprette og samle tråder. Så i dette tilfellet lønner det seg dermed å kjøre programmene med kun en tråd. 
Testene som følger denne vil dermed kun bruke en tråd og heller variere antall prosesser. 

\subsubsection{Hvorfor kun MPI er raskest?}

\subsection{Speedup og effektivitet}

\begin{table}
\begin{tabular}{c | c c c c c c c c c}

n/p & 1 & 2 & 4 & 8 & 12 & 24 & 36 & 48 & 96 \\
8 &	5.4001808166503906250000000e-05 & 3.6319096883138023092087859e-05 \\
16 &    2.6587645212809246598670287e-04 & 1.4833609263102212638164856e-04 \\
32 &    1.2506643931070964264468115e-03 & 6.5469741821289062500000000e-04 \\
64 &    5.7186683019002275754627540e-03 & 2.9246807098388671875000000e-03 \\
128 &   2.6107430458068847656250000e-02 & 1.3779799143473306713425508e-02 \\
256 &   1.1788566907246907089490406e-01 & 6.1504205067952476271297968e-02 \\
512 &   5.1830295721689856325298251e-01 & 2.6001699765523272889211626e-01 \\
1024 &  2.3079368273417153467619300e+00 & 1.1539564927419025952559650e+00 \\
2048 &  1.0080118298530578613281250e+01 & 5.0396489699681596974301101e+00 \\
4096 &	4.4799674709637962166652869e+01 & 2.2249505241711933223314190e+01 \\
8192 &	1.9275400197505950927734375e+02 & 9.6106613675753280290336988e+01 \\
16384 &	8.2507074578603112513519591e+02 & 4.1267060649394989013671875e+02 \\











\end{tabular}
\end{table}

\subsection{Ikke-homogene Dirichlet grensebetingelser}
Les \cite[seksjon 3.2]{poisson-fdm} for beskrivelse av dette med 1D-problem.

\subsection{Ikke enhetskvadrat}
Siden løsningen ikke er iterativ, 
\subsection{Forslag til forbedringer}

\input{sections/bibliography.tex}
\end{document}
